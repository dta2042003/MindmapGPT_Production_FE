<script setup lang="ts">
import { ref } from 'vue';
import { useForm, useField } from 'vee-validate';
import { loginUser } from '../../api/auth';
import * as yup from 'yup'; // ğŸ”¥ Import Ä‘Ãºng yup
import { NForm, NFormItem, NInput, NButton } from 'naive-ui';

const loginSchema = yup.object({
  email: yup.string().email('Email khÃ´ng há»£p lá»‡').required('Vui lÃ²ng nháº­p email'),
  password: yup.string().min(6, 'Máº­t kháº©u Ã­t nháº¥t 6 kÃ½ tá»±').required('Vui lÃ²ng nháº­p máº­t kháº©u'),
});

const { handleSubmit } = useForm({ validationSchema: loginSchema });

const { value: email, errorMessage: emailError } = useField<string>('email');
const { value: password, errorMessage: passwordError } = useField<string>('password');

const message = ref('');
const loading = ref(false);

const handleLogin = async () => {
  loading.value = true;
  const result = await loginUser({
    email: email.value,
    passwordHash: password.value,
  });
  loading.value = false;

  if (result.success) {
    message.value = 'ÄÄƒng nháº­p thÃ nh cÃ´ng..';
    window.location.href = "http://localhost:5173/home";
  } else {
    message.value = result.message;
  }
};

const onSubmit = handleSubmit(() => {
  handleLogin();
});
</script>

<template>
  <NForm @submit="onSubmit">
    <NFormItem label="Email" :feedback="emailError">
      <NInput v-model:value="email" placeholder="Nháº­p email" />
    </NFormItem>

    <NFormItem label="Máº­t kháº©u" :feedback="passwordError">
      <NInput v-model:value="password" type="password" placeholder="Nháº­p máº­t kháº©u" />
    </NFormItem>

    <NButton type="primary" block attr-type="submit">ÄÄƒng nháº­p</NButton>
    <p>{{ message }}</p>
  </NForm>
  <div class="register-link">
    <span>Báº¡n chÆ°a cÃ³ tÃ i khoáº£n?</span>
    <router-link to="/register">ÄÄƒng kÃ½ ngay</router-link>
  </div>
</template>
